<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b132b" />
  <title>IsiVolt Pro V1 Â· Legionella</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg-blob blob-a"></div>
  <div class="bg-blob blob-b"></div>
  <div class="bg-sheen"></div>

  <header class="topbar glass">
    <div class="brand">
      <div class="logo">âš¡</div>
      <div>
        <div class="title">IsiVolt Pro V1</div>
        <div class="subtitle">Legionella Control (PWA)</div>
      </div>
    </div>
    <div class="row">
      <button id="btnGuide" class="btn btn-ghost" title="GuÃ­a rÃ¡pida">ğŸ§</button>
      <button id="btnSettings" class="btn btn-ghost" title="Ajustes">âš™ï¸</button>
    </div>
  </header>

  <main class="container">
    <!-- Perfil -->
    <section id="screenProfile" class="screen">
      <div class="card glass">
        <h1>Acceso tÃ©cnico</h1>
        <p class="muted">Solo puede entrar el tÃ©cnico autorizado. Usa el acceso comÃºn del equipo.</p>
        <label class="label">Usuario</label>
        <div class="row">
          <input id="techName" class="input" placeholder="Usuario" maxlength="18" />
        </div>
        <label class="label">ContraseÃ±a</label>
        <div class="row">
          <input id="techPassword" class="input" type="password" placeholder="ContraseÃ±a" maxlength="32" />
          <button id="btnSetTech" class="btn">Entrar</button>
        </div>
        <div class="divider"></div>
        <p class="muted tiny">Acceso inicial por defecto: usuario <b>tecnico</b> Â· contraseÃ±a <b>1234</b>. Luego puedes cambiarlo dentro de la app.</p>
      </div>
    </section>

    <!-- Home -->
    <section id="screenHome" class="screen hidden">
      <div class="grid">
        <div class="card glass">
          <div class="kpi">
            <div>
              <div class="muted">TÃ©cnico</div>
              <div id="kpiTech" class="kpi-value">â€”</div>
            </div>
            <div class="row">
              <button id="btnEditAccess" class="btn btn-ghost">Acceso</button>
              <button id="btnSwitchTech" class="btn btn-ghost">Cambiar</button>
              <button id="btnLogout" class="btn btn-danger" title="Cerrar sesiÃ³n">Cerrar</button>
            </div>
          </div>

          <div class="kpi kpi-2">
            <div>
              <div class="muted">OT de hoy</div>
              <div id="kpiToday" class="kpi-value">0 / 0</div>
            </div>
            <div class="pill" id="pillOffline">Offline OK</div>
          </div>
        </div>

        <div class="card glass">
          <h2>Acciones rÃ¡pidas</h2>
          <div class="actions">
            <button id="btnScan" class="btn btn-primary">ğŸ“· Escanear QR</button>
            <button id="btnAddCode" class="btn">â• AÃ±adir punto</button>
            <button id="btnMonthly" class="btn btn-ghost">ğŸ§ª Informe mensual</button>
            <button id="btnHistory" class="btn btn-ghost">ğŸ•˜ Historial</button>
          </div>

          <div class="divider"></div>

          <div class="row">
            <button id="btnExplainOT" class="btn btn-ghost">â„¹ï¸ Â¿QuÃ© es OT de hoy?</button>
            <button id="btnClearOT" class="btn btn-danger">ğŸ—‘ï¸ Vaciar OT</button>
          </div>

          <p class="muted tiny">Tip: crea la lista en el taller (aÃ±adiendo puntos) y luego solo vas cerrando en campo.</p>
        </div>

        <div class="card glass">
          <h2>OT de hoy</h2>
          <div id="otList" class="list"></div>
          <div id="otEmpty" class="empty muted">AÃºn no hay puntos. AÃ±ade con QR o con el cÃ³digo (Ãºltimos 5).</div>
        </div>
      </div>
    </section>

    <!-- Scan -->
    <section id="screenScan" class="screen hidden">
      <div class="card glass">
        <div class="row space-between">
          <h2 id="scanTitle">Escanear QR</h2>
          <button class="btn btn-ghost" data-nav="home">âœ–</button>
        </div>

        <div class="muted tiny" id="scanHint">Si tu mÃ³vil no soporta escaneo nativo, usa â€œAÃ±adir puntoâ€.</div>

        <div class="scanbox">
          <video id="qrVideo" playsinline></video>
          <div class="scan-overlay"></div>
        </div>

        <div class="row">
          <button id="btnStartScan" class="btn btn-primary">Iniciar cÃ¡mara</button>
          <button id="btnStopScan" class="btn btn-ghost">Detener</button>
        </div>

        <div class="divider"></div>

        <div class="row">
          <input id="manualCodeFromScan" class="input" placeholder="O escribe cÃ³digo (se usan los 5 Ãºltimos)" />
          <button id="btnManualGo" class="btn">AÃ±adir</button>
        </div>
      </div>
    </section>

    <!-- Punto -->
    <section id="screenPoint" class="screen hidden">
      <div class="card glass">
        <div class="row space-between">
          <div>
            <div class="muted">UbicaciÃ³n</div>
            <div id="pointCode" class="bigcode">â€”</div>
          </div>
          <div class="row">
            <button id="btnEditCode" class="btn btn-ghost" title="Editar cÃ³digo">âœï¸ Editar</button>
            <button class="btn btn-ghost" data-nav="home">â¬…</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid2">
          <div class="panel glass-lite">
            <h3>Calculadora</h3>

            <label class="label">Litros de agua</label>
            <div class="row">
              <input id="liters" class="input" type="number" inputmode="decimal" min="0" step="1" placeholder="Ej: 60" />
              <button id="btnUseDefaultLiters" class="btn btn-ghost">Habitual</button>
            </div>

            <div class="muted tiny">Valores prefijados (provisionales) hasta confirmar protocolo real.</div>

            <div class="divider thin"></div>

            <div class="calc-result">
              <div class="muted">Dosis estimada (ml)</div>
              <div id="doseMl" class="dose">â€”</div>
              <div class="muted tiny">Queda registrada al finalizar.</div>
            </div>

            <div class="divider thin"></div>

            <label class="label">Tiempo objetivo</label>
            <div class="row">
              <input id="targetMinutes" class="input" type="number" min="1" step="1" />
              <button id="btnTimeAuto" class="btn btn-ghost">Auto</button>
            </div>

            <label class="label">ObservaciÃ³n (opcional)</label>
            <textarea id="pointNote" class="input textarea" rows="3" placeholder="Ej: baÃ±o sin retorno / puerta cerrada / pendiente..." ></textarea>

            <div class="row">
              <button id="btnSaveNote" class="btn btn-ghost">ğŸ’¾ Guardar nota</button>
              <button id="btnStartTimer" class="btn btn-primary">â± Iniciar proceso</button>
              <button id="btnMarkIssue" class="btn btn-danger">âš  Incidencia</button>
            </div>
          </div>

          <div class="panel glass-lite">
            <h3>Checklist</h3>
            <div class="checklist">
              <label><input type="checkbox" id="chkConnect" /> Conectar recirculaciÃ³n</label>
              <label><input type="checkbox" id="chkReturn" /> Verificar retorno</label>
              <label><input type="checkbox" id="chkDose" /> AÃ±adir dosis</label>
              <label><input type="checkbox" id="chkStart" /> Iniciar recirculaciÃ³n</label>
            </div>

            <div class="divider thin"></div>

            <div class="muted tiny">Al finalizar saldrÃ¡ el sello âœ… y quedarÃ¡ registrado en el historial con fecha/hora.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Timer -->
    <section id="screenTimer" class="screen hidden">
      <div class="card glass center">
        <div class="row space-between">
          <div>
            <div class="muted">En proceso</div>
            <div id="timerCode" class="bigcode">â€”</div>
          </div>
          <button class="btn btn-ghost" id="btnExitTimer">âœ–</button>
        </div>

        <div class="timer-tank">
          <div class="water" id="waterFill"></div>
          <div class="tank-glass"></div>
          <div class="timer-overlay">
            <div id="timerLeft" class="timer-left">00:00</div>
            <div class="muted tiny" id="timerTarget">Objetivo: â€”</div>
          </div>
        </div>

        <div class="row center">
          <button id="btnPause" class="btn btn-ghost">â¸ Pausar</button>
          <button id="btnResume" class="btn btn-ghost hidden">â–¶ Reanudar</button>
          <button id="btnFinish" class="btn btn-primary">âœ… Finalizar</button>
        </div>

        <div class="divider"></div>
        <div id="sealDone" class="seal hidden">âœ” TRATAMIENTO COMPLETADO</div>
        <div id="sealWarn" class="seal seal-warn hidden">âš  MARCADO CON INCIDENCIA</div>
      </div>
    </section>

    <!-- Historial -->
    <section id="screenHistory" class="screen hidden">
      <div class="card glass">
        <div class="row space-between">
          <h2>Historial</h2>
          <button class="btn btn-ghost" data-nav="home">â¬…</button>
        </div>

        <div class="row">
          <button id="btnExport" class="btn">ğŸ“¤ Exportar</button>
          <button id="btnImport" class="btn btn-ghost">ğŸ“¥ Importar</button>
          <input id="fileImport" type="file" accept="application/json" class="hidden" />
        </div>

        <div class="divider"></div>

        <div id="historyList" class="list"></div>
        <div id="historyEmpty" class="empty muted">Sin registros aÃºn.</div>
      </div>
    </section>

    <!-- Mensual PRO -->
    <section id="screenMonthly" class="screen hidden">
      <div class="card glass">
        <div class="row space-between">
          <h2>Informe mensual Â· Muestras (PRO)</h2>
          <button class="btn btn-ghost" data-nav="home">â¬…</button>
        </div>

        <div class="muted tiny">
          Crea la ruta del mes por plantas (-1, Baja, 1Âªâ€“8Âª). Exterior/Parking normalmente: <b>NO APLICA</b>.
          Los datos quedan en este mÃ³vil.
        </div>

        <div class="divider"></div>

        <div class="kpi kpi-2">
          <div>
            <div class="muted">Mes</div>
            <div id="kpiMonth" class="kpi-value">â€”</div>
          </div>
          <div>
            <div class="muted">Progreso</div>
            <div id="kpiMonthDone" class="kpi-value">0 / 0</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid2">
          <div class="panel glass-lite">
            <h3>Cabecera</h3>
            <label class="label">Fecha muestreo</label>
            <input id="monthSampleDate" class="input" type="date" />
            <label class="label">TÃ©cnico asignado (acompaÃ±a)</label>
            <input id="monthAssignedTech" class="input" placeholder="Ej: Paco" maxlength="18" />
            <label class="label">ObservaciÃ³n general (opcional)</label>
            <textarea id="monthHeaderNote" class="input textarea" rows="2" placeholder="Ej: ruta parcial / cambios..." ></textarea>
            <div class="row">
              <button id="btnSaveMonthlyHeader" class="btn btn-primary">Guardar cabecera</button>
              <button id="btnMonthlyExport" class="btn">ğŸ“¤ Exportar mensual</button>
            </div>
          </div>

          <div class="panel glass-lite">
            <h3>Documento (referencia)</h3>
            <div class="row">
              <button id="btnMonthlyAttach" class="btn">ğŸ“ Adjuntar PDF/Excel</button>
              <button id="btnMonthlyOpen" class="btn btn-ghost">ğŸ“„ Abrir adjunto</button>
              <input id="monthlyFile" type="file" accept="application/pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" class="hidden" />
            </div>

            <div class="divider thin"></div>

            <h3>Crear ruta</h3>
            <label class="label">Planta por defecto</label>
            <select id="monthlyPlantDefault" class="input">
              <option value="Baja">Baja</option>
              <option value="1Âª">1Âª</option><option value="2Âª">2Âª</option><option value="3Âª">3Âª</option><option value="4Âª">4Âª</option>
              <option value="5Âª">5Âª</option><option value="6Âª">6Âª</option><option value="7Âª">7Âª</option><option value="8Âª">8Âª</option>
              <option value="-1">-1</option>
              <option value="Otros">Otros</option>
            </select>

            <div class="actions">
              <button id="btnMonthlyScanHot" class="btn btn-primary">ğŸ”¥ Escanear ACS</button>
              <button id="btnMonthlyScanCold" class="btn btn-primary">â„ï¸ Escanear AFCH</button>
              <button id="btnMonthlyAdd" class="btn">â• AÃ±adir punto</button>
              <button id="btnMonthlyShowEmpty" class="btn btn-ghost">ğŸ‘ï¸ Mostrar vacÃ­as: OFF</button>
              <button id="btnMonthlyClear" class="btn btn-danger">ğŸ—‘ï¸ Vaciar mensual</button>
            </div>

            <div class="divider thin"></div>
            <div class="muted tiny">
              ImportaciÃ³n automÃ¡tica desde Excel/PDF: preparada para la siguiente iteraciÃ³n. De momento, la creaciÃ³n es ultrarrÃ¡pida con escaneo o â€œAÃ±adir puntoâ€.
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <span class="badge todo">â³ Pendiente</span>
          <span class="badge ok">âœ… Hecho</span>
          <span class="badge issue">âš  Incid.</span>
          <span class="badge na">ğŸš« No aplica</span>
        </div>

        <div class="divider"></div>

        <div id="monthlyAccordions" class="accordions"></div>
        <div id="monthlyEmpty" class="empty muted">AÃºn no hay puntos mensuales.</div>
      </div>
    </section>

    <!-- GuÃ­a -->
    <section id="screenGuide" class="screen hidden">
      <div class="card glass">
        <div class="row space-between">
          <h2>GuÃ­a rÃ¡pida (audio)</h2>
          <button class="btn btn-ghost" data-nav="home">â¬…</button>
        </div>

        <p class="muted">Pulsa â€œReproducirâ€ y el mÃ³vil te lo leerÃ¡ en voz alta (sin internet). Puedes editar el texto.</p>

        <div class="divider"></div>

        <div class="wavebox">
          <div class="wave"></div><div class="wave"></div><div class="wave"></div><div class="wave"></div><div class="wave"></div>
        </div>

        <div class="row center">
          <button id="btnSpeak" class="btn btn-primary">â–¶ Reproducir</button>
          <button id="btnStopSpeak" class="btn btn-ghost">â¹ Parar</button>
        </div>

        <div class="divider"></div>

        <textarea id="guideText" class="input textarea" rows="10"></textarea>
      </div>
    </section>

    <!-- Ajustes -->
    <div id="modalSettings" class="modal hidden">
      <div class="modal-card glass">
        <div class="row space-between">
          <h2>Ajustes (V1.3)</h2>
          <button id="btnCloseSettings" class="btn btn-ghost">âœ–</button>
        </div>

        <div class="grid2">
          <div class="panel glass-lite">
            <h3>LejÃ­a / dosis (provisional)</h3>
            <label class="label">% lejÃ­a (cloro activo aprox.)</label>
            <input id="bleachPct" class="input" type="number" min="1" max="12" step="0.5" />
            <label class="label">Objetivo ppm (mg/L)</label>
            <input id="targetPpm" class="input" type="number" min="1" step="1" />
          </div>

          <div class="panel glass-lite">
            <h3>Tiempos</h3>
            <label class="label">Tiempo base (min)</label>
            <input id="baseMin" class="input" type="number" min="1" step="1" />
            <label class="label">Factor por litro (min/L)</label>
            <input id="factorPerL" class="input" type="number" min="0" step="0.01" />
            <div class="muted tiny">Auto = base + (L Ã— factor). Si factor=0, queda fijo.</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button id="btnSaveSettings" class="btn btn-primary">Guardar</button>
          <button id="btnResetSettings" class="btn btn-danger">Restablecer</button>
        </div>
      </div>
    </div>

    <div id="modalAccess" class="modal hidden">
      <div class="modal-card glass">
        <div class="row space-between">
          <h2>Acceso comÃºn</h2>
          <button id="btnCloseAccess" class="btn btn-ghost">âœ–</button>
        </div>

        <p class="muted tiny">Desde aquÃ­ puedes cambiar el usuario y la contraseÃ±a que se pide para entrar a la app.</p>

        <label class="label">Nuevo usuario</label>
        <input id="accessUser" class="input" maxlength="18" placeholder="Usuario tÃ©cnico" />

        <label class="label">Nueva contraseÃ±a</label>
        <input id="accessPass" class="input" type="password" maxlength="32" placeholder="MÃ­nimo 4 caracteres" />

        <div class="row" style="margin-top:12px;">
          <button id="btnSaveAccess" class="btn btn-primary">Guardar acceso</button>
        </div>
      </div>
    </div>

  </main>

  <script type="module" src="app.js"></script>
</body>
</html>
